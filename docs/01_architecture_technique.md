# Chiron â€” Architecture Technique

> Assistant IA pour la prÃ©paration des conseils de classe

> DerniÃ¨re mise Ã  jour : 2026-01-26

---

## 1. Vision produit

Outil destinÃ© aux professeurs principaux pour gÃ©nÃ©rer des synthÃ¨ses trimestrielles personnalisÃ©es Ã  partir des bulletins scolaires (PDF PRONOTE).

**Workflow** : Import PDF â†’ Anonymisation NER â†’ OCR Cloud â†’ Extraction structurÃ©e â†’ GÃ©nÃ©ration LLM â†’ Validation humaine â†’ Export (dÃ©pseudonymisÃ©)

**Principes** :
- Le professeur reste dans la boucle (validation obligatoire)
- DonnÃ©es personnelles **jamais envoyÃ©es au cloud** (anonymisation PDF avant OCR)
- Ton et style adaptÃ©s via few-shot (exemples du prof)
- Application locale (.exe) + APIs cloud (OCR, LLM)

---

## 2. Architecture de dÃ©ploiement

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      APP LOCALE (.exe ~600MB)                       â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ pdfplumber      â”‚  â”‚ CamemBERT NER   â”‚  â”‚ PyMuPDF             â”‚ â”‚
â”‚  â”‚ (extraction nom)â”‚  â”‚ (variantes nom) â”‚  â”‚ (anonymisation PDF) â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ DuckDB          â”‚  â”‚ Streamlit UI    â”‚  â”‚ Mapping local       â”‚ â”‚
â”‚  â”‚ (stockage)      â”‚  â”‚ (interface)     â”‚  â”‚ (ELEVE_ID â†” nom)    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â”‚ PDF anonymisÃ© uniquement
                                   â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚            CLOUD (APIs)                 â”‚
              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
              â”‚  â”‚ Mistral OCR â”‚  â”‚ LLM (OpenAI,    â”‚  â”‚
              â”‚  â”‚             â”‚  â”‚ Anthropic, etc) â”‚  â”‚
              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Avantages** :
- RGPD OK : donnÃ©es personnelles jamais envoyÃ©es au cloud
- Mapping nom â†” ID reste en local sur PC du prof
- Mises Ã  jour faciles (seules les APIs changent cÃ´tÃ© cloud)

---

## 3. Structure du projet

```
chiron/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ llm/                    # Abstraction LLM multi-provider
â”‚   â”‚   â”œâ”€â”€ base.py             # Interface abstraite LLMClient
â”‚   â”‚   â”œâ”€â”€ manager.py          # Orchestrateur (registry pattern, rate limit, retry)
â”‚   â”‚   â”œâ”€â”€ config.py           # Settings (clÃ©s API, modÃ¨les, get_pricing())
â”‚   â”‚   â”œâ”€â”€ rate_limiter.py     # Sliding window rate limiter
â”‚   â”‚   â”œâ”€â”€ metrics.py          # Collecte mÃ©triques (tokens, coÃ»t, latence)
â”‚   â”‚   â”œâ”€â”€ pricing.py          # PricingCalculator centralisÃ©
â”‚   â”‚   â””â”€â”€ clients/
â”‚   â”‚       â”œâ”€â”€ anthropic.py    # Client Claude
â”‚   â”‚       â”œâ”€â”€ openai.py       # Client GPT
â”‚   â”‚       â””â”€â”€ mistral.py      # Client Mistral (chat + OCR)
â”‚   â”‚
â”‚   â”œâ”€â”€ document/               # Parsing PDF
â”‚   â”‚   â”œâ”€â”€ __init__.py         # Factory get_parser()
â”‚   â”‚   â”œâ”€â”€ parser.py           # Interface commune
â”‚   â”‚   â”œâ”€â”€ pdfplumber_parser.py # Parser local (extraction texte/tables)
â”‚   â”‚   â”œâ”€â”€ mistral_parser.py   # Parser cloud (Mistral OCR)
â”‚   â”‚   â”œâ”€â”€ patterns.py         # Regex extraction nom Ã©lÃ¨ve
â”‚   â”‚   â”œâ”€â”€ templates.py        # Templates bulletins
â”‚   â”‚   â””â”€â”€ pdf_generator.py    # GÃ©nÃ©ration PDF de test
â”‚   â”‚
â”‚   â”œâ”€â”€ privacy/                # RGPD
â”‚   â”‚   â”œâ”€â”€ config.py           # Settings pseudonymisation
â”‚   â”‚   â””â”€â”€ pseudonymizer.py    # Mapping nomâ†”pseudo, masquage texte
â”‚   â”‚
â”‚   â”œâ”€â”€ storage/                # Persistance DuckDB
â”‚   â”‚   â”œâ”€â”€ config.py           # Settings DB
â”‚   â”‚   â”œâ”€â”€ connection.py       # DuckDBConnection base class + singleton
â”‚   â”‚   â”œâ”€â”€ schemas.py          # CREATE TABLE SQL
â”‚   â”‚   â””â”€â”€ repositories/       # CRUD par entitÃ© (hÃ©ritent de DuckDBConnection)
â”‚   â”‚       â”œâ”€â”€ base.py         # DuckDBRepository[T] (hÃ©rite DuckDBConnection)
â”‚   â”‚       â”œâ”€â”€ classe.py       # ClasseRepository
â”‚   â”‚       â”œâ”€â”€ eleve.py        # EleveRepository
â”‚   â”‚       â””â”€â”€ synthese.py     # SyntheseRepository
â”‚   â”‚
â”‚   â”œâ”€â”€ generation/             # GÃ©nÃ©ration synthÃ¨ses
â”‚   â”‚   â”œâ”€â”€ prompt_builder.py   # Construction prompts few-shot
â”‚   â”‚   â””â”€â”€ generator.py        # SyntheseGenerator
â”‚   â”‚
â”‚   â”œâ”€â”€ api/                    # Backend REST FastAPI
â”‚   â”‚   â”œâ”€â”€ main.py             # App FastAPI + CORS
â”‚   â”‚   â”œâ”€â”€ config.py           # Settings API
â”‚   â”‚   â”œâ”€â”€ dependencies.py     # Injection dÃ©pendances
â”‚   â”‚   â””â”€â”€ routers/
â”‚   â”‚       â”œâ”€â”€ classes.py      # CRUD classes
â”‚   â”‚       â”œâ”€â”€ eleves.py       # CRUD Ã©lÃ¨ves
â”‚   â”‚       â”œâ”€â”€ syntheses.py    # GÃ©nÃ©ration + validation
â”‚   â”‚       â””â”€â”€ exports.py      # Import/Export CSV
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                   # Transverse
â”‚   â”‚   â”œâ”€â”€ constants.py        # Paths, config globale
â”‚   â”‚   â”œâ”€â”€ models.py           # Pydantic models partagÃ©s
â”‚   â”‚   â”œâ”€â”€ exceptions.py       # Exceptions custom
â”‚   â”‚   â”œâ”€â”€ validators.py       # Validateurs
â”‚   â”‚   â”œâ”€â”€ logging_config.py   # Configuration logging
â”‚   â”‚   â””â”€â”€ data_loader.py      # Chargement donnÃ©es
â”‚   â”‚
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ async_helpers.py    # Helpers async/sync
â”‚
â”œâ”€â”€ app/                        # Frontend Streamlit
â”‚   â”œâ”€â”€ main.py                 # Point d'entrÃ©e
â”‚   â”œâ”€â”€ config.py               # Settings UI
â”‚   â”œâ”€â”€ api_client.py           # Client HTTP vers FastAPI
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ 1_import.py         # Import PDF
â”‚   â”‚   â”œâ”€â”€ 2_review.py         # Review/edit synthÃ¨ses
â”‚   â”‚   â””â”€â”€ 3_export.py         # Export CSV
â”‚   â””â”€â”€ components/
â”‚       â”œâ”€â”€ sidebar.py          # Navigation
â”‚       â”œâ”€â”€ eleve_card.py       # Card Ã©lÃ¨ve
â”‚       â””â”€â”€ synthese_editor.py  # Ã‰diteur synthÃ¨se
â”‚
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ raw/                    # PDFs importÃ©s
â”‚   â”œâ”€â”€ processed/              # PDFs anonymisÃ©s
â”‚   â”œâ”€â”€ db/                     # DuckDB
â”‚   â”‚   â””â”€â”€ chiron.duckdb
â”‚   â””â”€â”€ exports/                # CSV exportÃ©s
â”‚
â”œâ”€â”€ notebooks/                  # Dev, tests, exploration
â”‚   â”œâ”€â”€ 01_parser_dev.ipynb
â”‚   â”œâ”€â”€ 02_generation_test.ipynb
â”‚   â”œâ”€â”€ 03_parser_benchmark.ipynb
â”‚   â”œâ”€â”€ 04_production_simulation.ipynb
â”‚   â””â”€â”€ 05_pdf_anonymization_test.ipynb
â”‚
â”œâ”€â”€ tests/
â”œâ”€â”€ scripts/
â”œâ”€â”€ docs/
â”œâ”€â”€ .env                        # ClÃ©s API (gitignored)
â”œâ”€â”€ .env.example
â”œâ”€â”€ pyproject.toml
â”œâ”€â”€ TODO.md                     # Suivi avancement
â””â”€â”€ README.md
```

---

## 4. Flow de traitement PDF (vue simplifiÃ©e)

```
PDF original
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Extraction nom (pdfplumber + regex)      â”‚ [local, rapide]
â”‚ 2. NER pour variantes (CamemBERT)           â”‚ [local, ~0.4s]
â”‚ 3. Anonymisation PDF (PyMuPDF redaction)    â”‚ [local, rapide]
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. OCR (Mistral OCR)                        â”‚ [cloud, ~2s]
â”‚ 5. Parsing structurÃ© â†’ EleveExtraction      â”‚ [TODO]
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Stockage DuckDB (pseudonymisÃ©)           â”‚
â”‚ 7. GÃ©nÃ©ration synthÃ¨se (LLM + few-shot)     â”‚
â”‚ 8. Validation par utilisateur               â”‚
â”‚ 9. Export CSV (dÃ©pseudonymisÃ©)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Workflow dÃ©taillÃ© Ã©tape par Ã©tape

### Vue d'ensemble des interactions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Streamlit  â”‚â”€â”€â”€â”€â–ºâ”‚  FastAPI    â”‚â”€â”€â”€â”€â–ºâ”‚   Modules   â”‚â”€â”€â”€â”€â–ºâ”‚   DuckDB    â”‚
â”‚  (Frontend) â”‚â—„â”€â”€â”€â”€â”‚  (Backend)  â”‚â—„â”€â”€â”€â”€â”‚   Python    â”‚â—„â”€â”€â”€â”€â”‚  (Storage)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  APIs Cloud â”‚
                    â”‚ (OCR, LLM)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Ã‰TAPE 1 : CrÃ©ation/sÃ©lection de classe

**Action utilisateur** : SÃ©lectionne ou crÃ©e une classe dans l'UI

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UI (Streamlit)                                                           â”‚
â”‚ â””â”€â–º Formulaire : nom="3Ã¨me A", niveau="3Ã¨me", etablissement="CollÃ¨ge X"  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼ POST /classes
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API (FastAPI)                                                            â”‚
â”‚ â””â”€â–º ClasseRepository.create(nom, niveau, etablissement)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼ INSERT
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DuckDB (chiron.duckdb)                                                   â”‚
â”‚ â””â”€â–º Table `classes` :                                                    â”‚
â”‚     id="cls_abc123", nom="3Ã¨me A", niveau="3Ã¨me", created_at=now()       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼ Response
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Retour API                                                               â”‚
â”‚ â””â”€â–º {"id": "cls_abc123", "nom": "3Ã¨me A", "status": "created"}           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Ã‰TAPE 2 : Import PDF bulletin

**Action utilisateur** : Upload un fichier PDF bulletin

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UI (Streamlit)                                                           â”‚
â”‚ â””â”€â–º File uploader : bulletin_3A_marie_dupont.pdf                         â”‚
â”‚ â””â”€â–º Classe sÃ©lectionnÃ©e : cls_abc123                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼ POST /import/pdf (multipart)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API (FastAPI)                                                            â”‚
â”‚ â””â”€â–º Sauvegarde fichier dans data/raw/                                    â”‚
â”‚ â””â”€â–º Appel module document/parser                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Ã‰TAPE 3 : Anonymisation PDF (avant envoi cloud)

**Traitement local** : ProtÃ©ger les donnÃ©es personnelles

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3a. Extraction nom depuis en-tÃªte (pdfplumber)                           â”‚
â”‚                                                                          â”‚
â”‚     Code : extract_eleve_name(pdf_path)                                  â”‚
â”‚     Input : PDF binaire                                                  â”‚
â”‚     Output : {"nom_complet": "Marie Dupont", "texte_complet": "..."}     â”‚
â”‚     Regex : r"[Ã‰E]l[Ã¨e]ve\s*:\s*([^\n]+)"                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3b. DÃ©tection variantes NER (CamemBERT)                                  â”‚
â”‚                                                                          â”‚
â”‚     Code : detect_name_variants(texte, nom_entete, nlp_ner)              â”‚
â”‚     Input : texte complet + "Marie Dupont"                               â”‚
â”‚     Processing : CamemBERT dÃ©tecte toutes les entitÃ©s PER                â”‚
â”‚     Output : ["Marie Dupont"] (variantes triÃ©es par longueur desc)       â”‚
â”‚     Temps : ~0.4s                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3c. Anonymisation PDF (PyMuPDF)                                          â”‚
â”‚                                                                          â”‚
â”‚     Code : anonymize_pdf(pdf_path, variants, "ELEVE_001")                â”‚
â”‚     Processing : page.add_redact_annot() pour chaque occurrence          â”‚
â”‚     Input : PDF original + ["Marie Dupont"] + "ELEVE_001"                â”‚
â”‚     Output : PDF bytes anonymisÃ© (8 remplacements)                       â”‚
â”‚                                                                          â”‚
â”‚     Avant : "Marie Dupont fournit un travail sÃ©rieux"                    â”‚
â”‚     AprÃ¨s : "ELEVE_001 fournit un travail sÃ©rieux"                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3d. Stockage mapping (privacy.duckdb)                                    â”‚
â”‚                                                                          â”‚
â”‚     Table `eleve_mapping` :                                              â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚     â”‚ eleve_id    â”‚ nom_original  â”‚ prenom_original  â”‚ classe_id â”‚      â”‚
â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚     â”‚ ELEVE_001   â”‚ Dupont        â”‚ Marie            â”‚ cls_abc123â”‚      â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Ã‰TAPE 4 : OCR Cloud (Mistral)

**Appel API externe** : Extraction texte depuis PDF anonymisÃ©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4a. Envoi Ã  Mistral OCR                                                  â”‚
â”‚                                                                          â”‚
â”‚     Code : mistral_client.ocr.process(model, document)                   â”‚
â”‚     Input : PDF anonymisÃ© encodÃ© en base64                               â”‚
â”‚     API : POST https://api.mistral.ai/v1/ocr                             â”‚
â”‚     Model : mistral-ocr-latest                                           â”‚
â”‚     CoÃ»t : ~$1 / 1000 pages                                              â”‚
â”‚     Temps : ~2s                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4b. RÃ©ponse Mistral OCR                                                  â”‚
â”‚                                                                          â”‚
â”‚     {                                                                    â”‚
â”‚       "pages": [{                                                        â”‚
â”‚         "markdown": "# College Test\n\n## BULLETIN SCOLAIRE\n\n         â”‚
â”‚           Ã‰lÃ¨ve : ELEVE_001\n\n| MatiÃ¨re | Note | ApprÃ©ciation |\n      â”‚
â”‚           |---|---|---|\n| Anglais | 15.21 | Bons rÃ©sultats... |"       â”‚
â”‚       }]                                                                 â”‚
â”‚     }                                                                    â”‚
â”‚                                                                          â”‚
â”‚     Note : Le nom est dÃ©jÃ  anonymisÃ© ("ELEVE_001" pas "Marie Dupont")   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Ã‰TAPE 5 : Parsing structurÃ© (TODO)

**Traitement local** : Transformer markdown en donnÃ©es structurÃ©es

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Parsing markdown â†’ EleveExtraction                                    â”‚
â”‚                                                                          â”‚
â”‚     Input (raw_text) :                                                   â”‚
â”‚     "| Anglais | 15.21 / 10.83 | Bons rÃ©sultats. ELEVE_001 fournit..."  â”‚
â”‚                                                                          â”‚
â”‚     Output (EleveExtraction) :                                           â”‚
â”‚     {                                                                    â”‚
â”‚       "eleve_id": "ELEVE_001",                                           â”‚
â”‚       "classe": "3Ã¨me A",                                                â”‚
â”‚       "trimestre": 1,                                                    â”‚
â”‚       "matieres": [                                                      â”‚
â”‚         {                                                                â”‚
â”‚           "nom": "Anglais",                                              â”‚
â”‚           "moyenne_eleve": 15.21,                                        â”‚
â”‚           "moyenne_classe": 10.83,                                       â”‚
â”‚           "appreciation": "Bons rÃ©sultats. ELEVE_001 fournit..."        â”‚
â”‚         },                                                               â”‚
â”‚         ...                                                              â”‚
â”‚       ],                                                                 â”‚
â”‚       "moyenne_generale": 14.13,                                         â”‚
â”‚       "raw_text": "..."  // ConservÃ© pour rÃ©fÃ©rence                      â”‚
â”‚     }                                                                    â”‚
â”‚                                                                          â”‚
â”‚     Status : TODO - Actuellement seul raw_text est rempli                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Ã‰TAPE 6 : Stockage Ã©lÃ¨ve en base

**Persistance** : Sauvegarder les donnÃ©es extraites

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API (FastAPI)                                                            â”‚
â”‚ â””â”€â–º EleveRepository.create(eleve_extraction, classe_id)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼ INSERT
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DuckDB (chiron.duckdb) - Table `eleves`                                  â”‚
â”‚                                                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ id         â”‚ classe_id  â”‚ eleve_id  â”‚ donnees_json                â”‚   â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚ â”‚ elv_xyz789 â”‚ cls_abc123 â”‚ ELEVE_001 â”‚ {"matieres": [...],         â”‚   â”‚
â”‚ â”‚            â”‚            â”‚           â”‚  "moyenne_generale": 14.13, â”‚   â”‚
â”‚ â”‚            â”‚            â”‚           â”‚  "raw_text": "..."}         â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                          â”‚
â”‚ Note : Pas de nom/prÃ©nom ici, uniquement eleve_id pseudonymisÃ©          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼ Response
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Retour API                                                               â”‚
â”‚ â””â”€â–º {"id": "elv_xyz789", "eleve_id": "ELEVE_001", "status": "imported"}  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Ã‰TAPE 7 : GÃ©nÃ©ration synthÃ¨se LLM

**Action utilisateur** : Clic sur "GÃ©nÃ©rer synthÃ¨se"

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UI (Streamlit)                                                           â”‚
â”‚ â””â”€â–º Bouton "GÃ©nÃ©rer" pour ELEVE_001                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼ POST /syntheses/generate
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API (FastAPI)                                                            â”‚
â”‚ â””â”€â–º Request : {"eleve_id": "ELEVE_001", "trimestre": 1}                  â”‚
â”‚ â””â”€â–º EleveRepository.get("ELEVE_001") â†’ EleveExtraction                   â”‚
â”‚ â””â”€â–º SyntheseGenerator.generate(eleve)                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7a. Construction prompt (PromptBuilder)                                  â”‚
â”‚                                                                          â”‚
â”‚     Messages :                                                           â”‚
â”‚     [                                                                    â”‚
â”‚       {"role": "system", "content": "Tu es un assistant pour PP..."},    â”‚
â”‚       {"role": "user", "content": "[Exemple 1 - donnÃ©es Ã©lÃ¨ve]"},        â”‚
â”‚       {"role": "assistant", "content": "[Exemple 1 - synthÃ¨se]"},        â”‚
â”‚       {"role": "user", "content": "[DonnÃ©es ELEVE_001 Ã  traiter]"}       â”‚
â”‚     ]                                                                    â”‚
â”‚                                                                          â”‚
â”‚     Note : Les donnÃ©es contiennent "ELEVE_001" pas "Marie Dupont"        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7b. Appel LLM (LLMManager)                                               â”‚
â”‚                                                                          â”‚
â”‚     Code : llm_manager.call_with_json_parsing_sync(provider, messages)   â”‚
â”‚     Provider : openai                                                    â”‚
â”‚     Model : gpt-4o-mini                                                  â”‚
â”‚     API : POST https://api.openai.com/v1/chat/completions                â”‚
â”‚     Format : response_format={"type": "json_object"}                     â”‚
â”‚     Temps : ~3-5s                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7c. RÃ©ponse LLM (JSON)                                                   â”‚
â”‚                                                                          â”‚
â”‚     {                                                                    â”‚
â”‚       "synthese_texte": "ELEVE_001 rÃ©alise un bon trimestre avec une     â”‚
â”‚         moyenne de 14.13. Des efforts sont Ã  fournir en EPS...",         â”‚
â”‚       "alertes": [                                                       â”‚
â”‚         {"matiere": "EPS", "description": "Note insuffisante",           â”‚
â”‚          "severite": "attention"}                                        â”‚
â”‚       ],                                                                 â”‚
â”‚       "reussites": [                                                     â”‚
â”‚         {"matiere": "Latin", "description": "Excellent investissement"}  â”‚
â”‚       ],                                                                 â”‚
â”‚       "posture_generale": "actif",                                       â”‚
â”‚       "axes_travail": ["RÃ©gularitÃ© en EPS", "Concentration"]             â”‚
â”‚     }                                                                    â”‚
â”‚                                                                          â”‚
â”‚     Note : La synthÃ¨se contient "ELEVE_001" (pseudonymisÃ©)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7d. Stockage synthÃ¨se (DuckDB)                                           â”‚
â”‚                                                                          â”‚
â”‚     Table `syntheses` :                                                  â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚     â”‚ id         â”‚ eleve_id  â”‚ tri â”‚ status   â”‚ synthese_texte     â”‚    â”‚
â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚     â”‚ syn_def456 â”‚ ELEVE_001 â”‚ 1   â”‚generated â”‚ "ELEVE_001 rÃ©alise â”‚    â”‚
â”‚     â”‚            â”‚           â”‚     â”‚          â”‚  un bon trimestre..â”‚    â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                          â”‚
â”‚     + alertes_json, reussites_json, posture_generale, axes_travail       â”‚
â”‚     + provider="openai", model="gpt-4o-mini"                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼ Response
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Retour API                                                               â”‚
â”‚ â””â”€â–º {                                                                    â”‚
â”‚       "synthese_id": "syn_def456",                                       â”‚
â”‚       "eleve_id": "ELEVE_001",                                           â”‚
â”‚       "status": "generated",                                             â”‚
â”‚       "synthese_texte": "ELEVE_001 rÃ©alise un bon trimestre..."          â”‚
â”‚     }                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Ã‰TAPE 8 : Validation par l'utilisateur

**Action utilisateur** : Relecture, Ã©dition optionnelle, validation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UI (Streamlit) - Page Review                                             â”‚
â”‚                                                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ELEVE_001 - Trimestre 1                              [âœ“ Valider]   â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ SynthÃ¨se :                                                          â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚ â”‚ â”‚ ELEVE_001 rÃ©alise un bon trimestre avec une moyenne de 14.13.  â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ Des efforts sont Ã  fournir en EPS...                            â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚ â”‚                                                                     â”‚ â”‚
â”‚ â”‚ Alertes : ğŸ”´ EPS - Note insuffisante                               â”‚ â”‚
â”‚ â”‚ RÃ©ussites : ğŸŸ¢ Latin - Excellent investissement                    â”‚ â”‚
â”‚ â”‚ Posture : actif                                                     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Si Ã©dition** :
```
                                    â”‚ PATCH /syntheses/{id}
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API (FastAPI)                                                            â”‚
â”‚ â””â”€â–º Request : {"synthese_texte": "[texte modifiÃ© par le prof]"}          â”‚
â”‚ â””â”€â–º SyntheseRepository.update(id, synthese_texte, status="edited")       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Validation** :
```
                                    â”‚ POST /syntheses/{id}/validate
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API (FastAPI)                                                            â”‚
â”‚ â””â”€â–º SyntheseRepository.update_status(id, "validated", validated_by)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼ UPDATE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DuckDB - Table `syntheses`                                               â”‚
â”‚                                                                          â”‚
â”‚     status: "generated" â†’ "validated"                                    â”‚
â”‚     validated_at: "2026-01-26 14:30:00"                                  â”‚
â”‚     validated_by: "Prof. Martin"                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Ã‰TAPE 9 : Export CSV (dÃ©pseudonymisÃ©)

**Action utilisateur** : Export des synthÃ¨ses validÃ©es

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UI (Streamlit) - Page Export                                             â”‚
â”‚ â””â”€â–º Filtres : classe="3Ã¨me A", trimestre=1, status="validated"           â”‚
â”‚ â””â”€â–º Bouton "Exporter CSV"                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼ GET /export/csv?classe_id=...&status=validated
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API (FastAPI)                                                            â”‚
â”‚                                                                          â”‚
â”‚ 9a. RÃ©cupÃ©rer synthÃ¨ses validÃ©es                                         â”‚
â”‚     â””â”€â–º SyntheseRepository.get_by_status(classe_id, "validated")         â”‚
â”‚     â””â”€â–º RÃ©sultat : [{eleve_id: "ELEVE_001", synthese_texte: "..."}]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9b. DÃ©pseudonymisation                                                   â”‚
â”‚                                                                          â”‚
â”‚     Code : pseudonymizer.depseudonymize_text(synthese_texte)             â”‚
â”‚                                                                          â”‚
â”‚     Avant : "ELEVE_001 rÃ©alise un bon trimestre..."                      â”‚
â”‚                                                                          â”‚
â”‚     Lookup dans privacy.duckdb :                                         â”‚
â”‚     ELEVE_001 â†’ {"nom": "Dupont", "prenom": "Marie"}                     â”‚
â”‚                                                                          â”‚
â”‚     AprÃ¨s : "Marie Dupont rÃ©alise un bon trimestre..."                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9c. GÃ©nÃ©ration CSV                                                       â”‚
â”‚                                                                          â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â” â”‚
â”‚     â”‚ Ã‰lÃ¨ve        â”‚ SynthÃ¨se                        â”‚ Alertes â”‚Statusâ”‚ â”‚
â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚     â”‚ Marie Dupont â”‚ Marie Dupont rÃ©alise un bon ... â”‚ EPS     â”‚  âœ“   â”‚ â”‚
â”‚     â”‚ Jean Martin  â”‚ Jean Martin montre une ...      â”‚         â”‚  âœ“   â”‚ â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚     Note : Les vrais noms sont restaurÃ©s dans le fichier final           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼ Response (file download)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Fichier : syntheses_3A_T1_2026-01-26.csv                                 â”‚
â”‚ Sauvegarde : data/exports/                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### RÃ©sumÃ© des donnÃ©es stockÃ©es

| Base | Table | Contenu | DonnÃ©es sensibles |
|------|-------|---------|-------------------|
| `chiron.duckdb` | `classes` | id, nom, niveau, etablissement | Non |
| `chiron.duckdb` | `eleves` | id, classe_id, **eleve_id** (pseudo), donnees_json | Non (pseudonymisÃ©) |
| `chiron.duckdb` | `syntheses` | id, eleve_id, texte, alertes, status | Non (pseudonymisÃ©) |
| `privacy.duckdb` | `eleve_mapping` | **eleve_id â†” nom_original** | **OUI** (local uniquement) |

---

### RÃ©sumÃ© des appels API externes

| Ã‰tape | Service | Endpoint | DonnÃ©es envoyÃ©es | SÃ©curitÃ© |
|-------|---------|----------|------------------|----------|
| 4 | Mistral OCR | POST /v1/ocr | PDF **anonymisÃ©** (base64) | âœ… Pas de nom |
| 7 | OpenAI/Anthropic | POST /chat/completions | Texte **pseudonymisÃ©** | âœ… ELEVE_XXX |

---

## 6. ModÃ¨le de donnÃ©es DuckDB (dÃ©tail)

### Vue d'ensemble

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              ARCHITECTURE DONNÃ‰ES                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  chiron.duckdb                           privacy.duckdb                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  classes    â”‚                         â”‚  eleve_mapping  â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                         â”‚  (nom â†” pseudo) â”‚                â”‚
â”‚         â”‚ 1:N                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     DonnÃ©es sensibles                                      â”‚
â”‚  â”‚   eleves    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  JAMAIS dans chiron.duckdb       â”‚
â”‚  â”‚             â”‚                                                            â”‚
â”‚  â”‚ raw_text_ocrâ”‚     Code versionnÃ©                                         â”‚
â”‚  â”‚ raw_text_anoâ”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  src/generation/prompts.py       â”‚
â”‚  â”‚ donnees_jsonâ”‚                                                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                            â”‚
â”‚         â”‚ 1:N                                                               â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                            â”‚
â”‚  â”‚  syntheses  â”‚                                                            â”‚
â”‚  â”‚             â”‚                                                            â”‚
â”‚  â”‚ llm_responseâ”‚     RÃ©fÃ©rence prompt                                       â”‚
â”‚  â”‚ prompt_templâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  "synthese_v1" (pas le texte)    â”‚
â”‚  â”‚ tokens/cost â”‚                                                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                            â”‚
â”‚                                                                             â”‚
â”‚  Fichiers                                                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€                                                                   â”‚
â”‚  data/raw/{eleve_id}.pdf          # PDF original (renommÃ© avec pseudo)      â”‚
â”‚  data/processed/{eleve_id}.pdf    # PDF anonymisÃ©                           â”‚
â”‚  data/fewshot/*.json              # Exemples few-shot versionnÃ©s            â”‚
â”‚  data/exports/*.csv               # Exports (avec vrais noms)               â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Table `classes`

```sql
CREATE TABLE classes (
    id              VARCHAR PRIMARY KEY,  -- UUID
    nom             VARCHAR NOT NULL,     -- "3Ã¨me A"
    niveau          VARCHAR,              -- "3Ã¨me"
    etablissement   VARCHAR,              -- "CollÃ¨ge Victor Hugo"
    annee_scolaire  VARCHAR,              -- "2024-2025"
    created_at      TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at      TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### Table `eleves`

```sql
CREATE TABLE eleves (
    id                  VARCHAR PRIMARY KEY,  -- UUID interne
    eleve_id            VARCHAR NOT NULL,     -- Pseudonyme "ELEVE_001"
    classe_id           VARCHAR NOT NULL REFERENCES classes(id),
    trimestre           INTEGER,              -- 1, 2, 3

    -- DonnÃ©es extraites (ANONYMISÃ‰ES - pas de nom/prÃ©nom ici)
    raw_text_ocr        TEXT,                 -- Markdown brut Mistral OCR
    raw_text_anonymise  TEXT,                 -- Markdown avec ELEVE_XXX
    donnees_json        JSON,                 -- EleveExtraction (matiÃ¨res, notes...)

    -- MÃ©tadonnÃ©es OCR
    ocr_provider        VARCHAR,              -- "mistral"
    ocr_model           VARCHAR,              -- "mistral-ocr-latest"
    ocr_cost            FLOAT,                -- CoÃ»t en $
    ocr_duration_ms     INTEGER,              -- Temps de traitement

    created_at          TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at          TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    UNIQUE(eleve_id, trimestre)
);
```

### Table `syntheses`

```sql
CREATE TABLE syntheses (
    id                  VARCHAR PRIMARY KEY,
    eleve_id            VARCHAR NOT NULL REFERENCES eleves(eleve_id),
    trimestre           INTEGER NOT NULL,
    status              VARCHAR DEFAULT 'draft',  -- draft|generated|edited|validated

    -- Contenu gÃ©nÃ©rÃ©
    synthese_texte      TEXT,                 -- Texte final (peut Ãªtre Ã©ditÃ©)
    llm_response_raw    TEXT,                 -- RÃ©ponse JSON brute du LLM
    alertes_json        JSON,
    reussites_json      JSON,
    posture_generale    VARCHAR,
    axes_travail_json   JSON,

    -- MÃ©tadonnÃ©es LLM
    llm_provider        VARCHAR,              -- "openai"
    llm_model           VARCHAR,              -- "gpt-4o-mini"
    prompt_template     VARCHAR,              -- "synthese_v1" (rÃ©fÃ©rence code)
    prompt_hash         VARCHAR,              -- SHA256 pour audit
    tokens_input        INTEGER,
    tokens_output       INTEGER,
    tokens_total        INTEGER,
    llm_cost            FLOAT,                -- CoÃ»t en $
    llm_duration_ms     INTEGER,
    llm_temperature     FLOAT,

    -- Erreurs/retry
    retry_count         INTEGER DEFAULT 0,
    error_message       TEXT,

    -- Validation
    validated_by        VARCHAR,
    validated_at        TIMESTAMP,
    edited_at           TIMESTAMP,

    created_at          TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at          TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    UNIQUE(eleve_id, trimestre)
);
```

### Table `eleve_mapping` (privacy.duckdb - SÃ‰PARÃ‰)

```sql
-- Base SÃ‰PARÃ‰E : privacy.duckdb (jamais synchronisÃ©/uploadÃ©)
CREATE TABLE eleve_mapping (
    eleve_id            VARCHAR PRIMARY KEY,  -- "ELEVE_001"
    nom_original        VARCHAR NOT NULL,     -- "Dupont"
    prenom_original     VARCHAR,              -- "Marie"
    classe_id           VARCHAR NOT NULL,
    etablissement       VARCHAR,              -- "CollÃ¨ge Victor Hugo"
    created_at          TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### Gestion des prompts (versionnÃ©s dans le code)

```python
# src/generation/prompts.py
PROMPT_TEMPLATES = {
    "synthese_v1": {
        "version": "1.0.0",
        "system": """Tu es un assistant pour professeur principal...""",
        "user": """RÃ©dige une synthÃ¨se pour cet Ã©lÃ¨ve:\n\n{eleve_data}"""
    }
}
CURRENT_PROMPT = "synthese_v1"
```

En base, on stocke uniquement `prompt_template="synthese_v1"` + `prompt_hash` pour traÃ§abilitÃ©.

---

## 7. SchÃ©mas de donnÃ©es (Pydantic)

### Extraction bulletin (input)

```python
class MatiereExtraction(BaseModel):
    nom: str                        # "MathÃ©matiques"
    professeur: str | None          # "Mme AJENJO"
    moyenne_eleve: float | None     # 12.5
    moyenne_classe: float | None    # 13.2
    note_ecrit: float | None        # Pour langues
    note_oral: float | None         # Pour langues
    competences: list[str]          # Ã‰lÃ©ments du programme travaillÃ©s
    appreciation: str               # Texte libre

class EleveExtraction(BaseModel):
    # IdentitÃ©
    eleve_id: str | None            # GÃ©nÃ©rÃ© aprÃ¨s pseudonymisation
    nom: str | None                 # Avant pseudonymisation
    prenom: str | None
    genre: Literal["Fille", "GarÃ§on"] | None

    # Contexte scolaire
    etablissement: str | None
    classe: str | None
    trimestre: int | None
    annee_scolaire: str | None      # "2024-2025"

    # RÃ©sultats
    matieres: list[MatiereExtraction]
    moyenne_generale: float | None

    # Vie scolaire
    engagements: list[str]          # ["DÃ©lÃ©guÃ©(e) titulaire"]
    absences_demi_journees: int | None
    absences_justifiees: bool | None
    retards: int | None

    # DonnÃ©es brutes (pour post-traitement)
    raw_text: str | None
    raw_tables: list | None
```

### GÃ©nÃ©ration synthÃ¨se (output LLM)

```python
class Alerte(BaseModel):
    matiere: str
    description: str
    severite: Literal["urgent", "attention"]

class Reussite(BaseModel):
    matiere: str
    description: str

class SyntheseGeneree(BaseModel):
    synthese_texte: str
    alertes: list[Alerte]
    reussites: list[Reussite]
    posture_generale: Literal["actif", "passif", "perturbateur", "variable"]
    axes_travail: list[str]         # ["Participation orale", "RÃ©gularitÃ©"]
```

---

## 8. Composants LLM

### Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     src/llm/                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  config.py          â†’ LLMSettings (clÃ©s API, RPM, pricing)  â”‚
â”‚                     â†’ get_model(), get_rpm(), get_pricing() â”‚
â”‚  manager.py         â†’ LLMManager (registry pattern)         â”‚
â”‚                     â†’ CLIENT_REGISTRY pour extensibilitÃ©    â”‚
â”‚  rate_limiter.py    â†’ ContrÃ´le dÃ©bit par provider           â”‚
â”‚  metrics.py         â†’ Collecte tokens/coÃ»t/latence          â”‚
â”‚  pricing.py         â†’ PricingCalculator centralisÃ©          â”‚
â”‚  clients/           â†’ Clients spÃ©cifiques :                 â”‚
â”‚    â”œâ”€â”€ openai.py    â†’ OpenAIClient (gpt-5-mini, etc.)      â”‚
â”‚    â”œâ”€â”€ anthropic.py â†’ AnthropicClient (claude-sonnet-4-5)  â”‚
â”‚    â””â”€â”€ mistral.py   â†’ MistralClient (chat + OCR)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Registry Pattern (ajout facile de providers)

```python
# src/llm/manager.py
CLIENT_REGISTRY: dict[str, type[LLMClient]] = {
    "openai": OpenAIClient,
    "anthropic": AnthropicClient,
    "mistral": MistralClient,
}
# Ajouter un provider = 1 ligne
```

### Flux d'appel

```python
SyntheseGenerator.generate(eleve)
    â”‚
    â”œâ”€â”€ PromptBuilder.build_messages()   # Few-shot + donnÃ©es Ã©lÃ¨ve
    â”‚
    â””â”€â”€ LLMManager.call_with_json_parsing_sync()
            â”‚
            â”œâ”€â”€ rate_limiter.acquire()   # Attente si quota atteint
            â”œâ”€â”€ client.call()            # Appel HTTP au provider
            â”œâ”€â”€ JSON parsing + retry     # Extraction rÃ©ponse
            â””â”€â”€ return SyntheseGeneree   # ModÃ¨le Pydantic validÃ©
```

### Providers supportÃ©s

| Provider | ModÃ¨les | Usage |
|----------|---------|-------|
| OpenAI | gpt-4o, gpt-4o-mini | GÃ©nÃ©ration synthÃ¨ses |
| Anthropic | claude-3.5-sonnet, claude-3-haiku | GÃ©nÃ©ration synthÃ¨ses |
| Mistral | mistral-large, mistral-ocr-latest | Chat + **OCR PDF** |

---

## 9. API REST (FastAPI)

### Endpoints implÃ©mentÃ©s

| MÃ©thode | Route | Description | Status |
|---------|-------|-------------|--------|
| `GET` | `/health` | Health check | âœ… |
| `GET` | `/` | Info API | âœ… |
| `GET` | `/classes` | Lister classes | âœ… |
| `POST` | `/classes` | CrÃ©er classe | âœ… |
| `GET` | `/classes/{id}` | DÃ©tail classe | âœ… |
| `GET` | `/eleves` | Lister Ã©lÃ¨ves | âœ… |
| `POST` | `/eleves` | CrÃ©er Ã©lÃ¨ve | âœ… |
| `GET` | `/eleves/{id}` | DÃ©tail Ã©lÃ¨ve | âœ… |
| `POST` | `/syntheses/generate` | GÃ©nÃ©rer synthÃ¨se | âœ… ConnectÃ© |
| `PATCH` | `/syntheses/{id}` | Modifier synthÃ¨se | âœ… |
| `POST` | `/syntheses/{id}/validate` | Valider synthÃ¨se | âœ… |
| `GET` | `/syntheses/pending` | SynthÃ¨ses en attente | âœ… |
| `DELETE` | `/syntheses/{id}` | Supprimer synthÃ¨se | âœ… |
| `POST` | `/import/pdf` | Import PDF | âœ… |
| `GET` | `/export/csv` | Export CSV | âœ… |

### Configuration CORS

```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:8501"],  # Streamlit
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

---

## 10. Interface Streamlit

### Pages

1. **Import** (`1_import.py`)
   - SÃ©lection/crÃ©ation classe
   - Upload PDF(s) bulletin
   - Parsing et prÃ©visualisation

2. **Review** (`2_review.py`)
   - Liste Ã©lÃ¨ves avec status
   - GÃ©nÃ©ration synthÃ¨ses (Ã  connecter)
   - Ã‰dition inline
   - Validation

3. **Export** (`3_export.py`)
   - Filtres (classe, trimestre, status)
   - PrÃ©visualisation tableau
   - Export CSV

### Composants

- `sidebar.py` : Navigation et sÃ©lection classe
- `eleve_card.py` : Affichage donnÃ©es Ã©lÃ¨ve
- `synthese_editor.py` : Ã‰diteur texte + insights

---

## 11. Anonymisation PDF (NER)

### StratÃ©gie

1. **Extraction nom** : pdfplumber + regex `Ã‰lÃ¨ve : XXX`
2. **DÃ©tection variantes** : CamemBERT NER (`Jean-Baptiste/camembert-ner`)
3. **Anonymisation** : PyMuPDF redaction (remplacement visuel dans PDF)
4. **Envoi cloud** : PDF anonymisÃ© uniquement
5. **Mapping local** : Table DuckDB pour dÃ©pseudonymisation export

### ModÃ¨le NER sÃ©lectionnÃ©

| ModÃ¨le | Temps | Faux positifs | Choix |
|--------|-------|---------------|-------|
| spaCy fr_core_news_lg | 0.12s | Oui | âŒ |
| CamemBERT v1 | 0.4s | Non | âœ… **SÃ©lectionnÃ©** |
| CamemBERTav2 | 1.6s | Non | âŒ Trop lent |

### Code testÃ© (notebook 05)

```python
# 1. Extraire nom depuis en-tÃªte
eleve_info = extract_eleve_name(pdf_path)  # {"nom_complet": "Marie Dupont", ...}

# 2. DÃ©tecter variantes avec NER
variants = detect_name_variants(text, nom_entete, nlp_ner)
# -> ["Marie Dupont"]

# 3. Anonymiser PDF
pdf_bytes, count = anonymize_pdf(pdf_path, variants, "ELEVE_001")
# -> PDF avec "ELEVE_001" Ã  la place de "Marie Dupont"

# 4. Envoyer Ã  Mistral OCR
result = extract_with_mistral_ocr(pdf_bytes)
# -> Markdown structurÃ©, anonymisÃ©
```

---

## 12. Stack technique

| Composant | Technologie |
|-----------|-------------|
| Runtime | Python 3.11+ |
| LLM Chat | OpenAI GPT-4o-mini / Claude Sonnet |
| LLM OCR | **Mistral OCR** (mistral-ocr-latest) |
| NER | **CamemBERT** (Jean-Baptiste/camembert-ner) |
| PDF manipulation | **PyMuPDF** (fitz) + pdfplumber |
| Base de donnÃ©es | DuckDB (fichier local) |
| Backend API | FastAPI + Uvicorn |
| Frontend | Streamlit |
| Validation donnÃ©es | Pydantic v2 |
| HTTP async | httpx |
| Retry/backoff | tenacity |
| Tests | pytest + pytest-asyncio |
| Packaging | uv + pyproject.toml |

---

## 13. Configuration (.env)

```env
# LLM Providers
OPENAI_API_KEY=sk-...
ANTHROPIC_API_KEY=sk-ant-...
MISTRAL_API_KEY=...

# Mistral OCR
MISTRAL_OCR_API_KEY=...
MISTRAL_OCR_MODEL=mistral-ocr-latest

# Default LLM
DEFAULT_LLM_PROVIDER=openai
DEFAULT_LLM_MODEL=gpt-4o-mini

# Rate limits (requests per minute)
OPENAI_RPM=60
ANTHROPIC_RPM=50
MISTRAL_RPM=60

# API
API_HOST=0.0.0.0
API_PORT=8000
CORS_ORIGINS=["http://localhost:8501"]

# Database
DB_PATH=data/db/chiron.duckdb

# Privacy
PRIVACY_DB_PATH=data/db/privacy.duckdb
PSEUDONYM_PREFIX=ELEVE_
```

---

## 14. SÃ©curitÃ© & RGPD

| Aspect | Mesure |
|--------|--------|
| DonnÃ©es Ã©lÃ¨ves | **AnonymisÃ©es dans le PDF** avant envoi cloud |
| Stockage local | DuckDB fichier local, pas de cloud |
| Mapping identitÃ©s | Base sÃ©parÃ©e (`privacy.duckdb`) |
| OCR cloud | ReÃ§oit uniquement PDFs anonymisÃ©s |
| LLM cloud | ReÃ§oit uniquement donnÃ©es pseudonymisÃ©es |
| Logs | Pas de donnÃ©es personnelles |
| Validation humaine | Obligatoire avant export |

---

## 15. Estimation taille packaging

| Composant | Taille |
|-----------|--------|
| Python runtime | ~30 MB |
| PyTorch + CamemBERT | ~450 MB |
| pdfplumber, PyMuPDF | ~20 MB |
| Streamlit | ~80 MB |
| DuckDB | ~10 MB |
| **Total estimÃ©** | **~600 MB - 1 GB** |
